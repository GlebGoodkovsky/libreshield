document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("currentSite"),t=document.getElementById("blockSiteBtn"),o=document.getElementById("allowSiteBtn"),n=document.getElementById("openOptionsBtn"),d=document.getElementById("powerToggle"),i=document.getElementById("powerStatus");let a="",c={};async function r(){c=await chrome.storage.local.get({blockedDomains:[],allowedSites:[],isBlockingEnabled:!0,theme:"light"}),document.body.classList.toggle("dark-mode","dark"===c.theme),d.checked=c.isBlockingEnabled,i.textContent=c.isBlockingEnabled?"ON":"OFF";try{const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(r&&r.url&&!r.url.startsWith("about:")){const t=new URL(r.url);a=t.hostname,e.textContent=a,s()}else throw new Error("Special or invalid page")}catch(t){e.textContent="N/A",blockSiteBtn.disabled=!0,allowSiteBtn.disabled=!0}}function s(){if(!a)return;const e=c.blockedDomains.includes(a),n=c.allowedSites.includes(a);t.textContent=e?"Already Blocked":"Block This Site",t.disabled=e,o.textContent=n?"Already Allowed":"Allow This Site",o.disabled=n}async function l(e,t){"blockedDomains"===e?(c.blockedDomains.push(t),c.allowedSites=c.allowedSites.filter(e=>e!==t)):"allowedSites"===e&&(c.allowedSites.push(t),c.blockedDomains=c.blockedDomains.filter(e=>e!==t)),await chrome.storage.local.set(c),s()}d.addEventListener("change",()=>{c.isBlockingEnabled=d.checked,i.textContent=c.isBlockingEnabled?"ON":"OFF",chrome.storage.local.set({isBlockingEnabled:c.isBlockingEnabled})}),t.addEventListener("click",()=>l("blockedDomains",a)),o.addEventListener("click",()=>l("allowedSites",a)),n.addEventListener("click",()=>{chrome.runtime.openOptionsPage(),window.close()}),r()});
